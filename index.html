<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="prueb.css">
</head>

<body>


  <header>
    <nav>
      <ul>
        <li><a>CamMonitor</a></li>
        <li><a>✅Conectado</a></li>
        <li>
          <a href="#">
            <img src="images/isatis.png" alt="Logo" style="height: 35px;">
          </a>
         </li>
      </ul>
    </nav>

  </header>

  <section class="container">

    <div class ="Gri">1</div>
    <div class="Gri">
  <div class="notif-header">
    <label style="font-size: 1.1em;">Notificaciones</label>

    <button class="HorarioBtn">⏱ Horario</button>
  </div>

  <div id="notificaciones"></div>
</div>


    <div class ="Gri">
      <span class="H_title">
        <label style="font-size: 1.1em;">Historial de capturas</label>
        <a href="images.html">
          <button class="btn-ver-todas">Ver todas</button>
        </a>
        
      </span>

      <div class="S_img">
      <div class="H_img" id="cap1">Cap 1</div>
      <div class="H_img" id="cap2">Cap 2</div>

      </div>
    </div>

    <div class="Gri">
  <label style="font-size: 1.1em;">Configuración</label> 
  <br>

  <span>
    <label>Nombre de la red:</label>
    <input id="ssid" type="text" placeholder="Nombre de la red" maxlength="32">
  </span>

  <br>

  <span>
    <label>Contraseña:</label>
    <input id="password" type="password" placeholder="Contraseña" maxlength="63">
  </span>

  <br>

  <span>
    <button class="btn-config" onclick="reiniciarConfig()">Reiniciar</button>
    <button class="btn-config" onclick="enviarConfig()">Enviar</button>
  </span>
</div>

<div class="Gri">
  <label style="font-size: 1.1em;">Monitor Serial</label><br>
  <div id="serial-box" style="height: 90%; overflow-y: auto; padding: 5px;"></div>
</div>


  </section>

  <script>
/* ===== VALIDACIÓN DE CAMPOS ===== */

function validarConfig() {
    const ssid = document.getElementById("ssid").value.trim();
    const pass = document.getElementById("password").value.trim();

    // SSID debe tener letras, números y algunos símbolos comunes
    const ssidRegex = /^[A-Za-z0-9 _.\-]{3,32}$/;

    if (!ssidRegex.test(ssid)) {
        alert("❌ Nombre de red inválido.\nDebe tener entre 3 y 32 caracteres y solo usar letras, números y . _ -");
        return false;
    }

    // Contraseña mínima de 8
    if (pass.length < 8) {
        alert("❌ La contraseña debe tener mínimo 8 caracteres.");
        return false;
    }

    // Máximo permitido por estándar WPA2
    if (pass.length > 63) {
        alert("❌ La contraseña no puede exceder 63 caracteres.");
        return false;
    }

    // No emojis
    if (/[\u{1F600}-\u{1F6FF}]/u.test(pass)) {
        alert("❌ La contraseña no puede contener emojis.");
        return false;
    }

    // ASCII estándar
    if (!/^[\x20-\x7E]+$/.test(pass)) {
        alert("❌ La contraseña contiene caracteres no permitidos.");
        return false;
    }

    return true;
}

/* ===== ACCIONES DE BOTONES ===== */

function reiniciarConfig() {
    document.getElementById("ssid").value = "";
    document.getElementById("password").value = "";
}

function enviarConfig() {
    if (!validarConfig()) return;

    const ssid = document.getElementById("ssid").value.trim();
    const pass = document.getElementById("password").value.trim();

    alert("✔ Configuración enviada:\nSSID: " + ssid + "\nContraseña: " + pass);
}
</script>
  
<script src="serial.js"></script>
<script>
const API_URL_IMG = "https://api-camara.vercel.app/get/img";

async function cargarUltimasCapturas() {
    try {
        const res = await fetch(API_URL_IMG, { cache: "no-store" });
        const data = await res.json();

        if (!Array.isArray(data) || data.length === 0) return;

        // Tomar las dos últimas imágenes (más nuevas)
        const ultimas = [...data].slice(-2).reverse();

        // Cap 1
        if (ultimas[0]) {
            document.getElementById("cap1").innerHTML =
                `<img src="data:image/jpeg;base64,${ultimas[0].content}" 
                      style="width:100%; height:100%; object-fit:cover; border-radius:12px;">`;
        }

        // Cap 2
        if (ultimas[1]) {
            document.getElementById("cap2").innerHTML =
                `<img src="data:image/jpeg;base64,${ultimas[1].content}" 
                      style="width:100%; height:100%; object-fit:cover; border-radius:12px;">`;
        }

    } catch (err) {
        console.error("Error cargando últimas capturas:", err);
    }
}

// Cargar de inmediato
cargarUltimasCapturas();

</script>

<!-- Modal de horario -->
<div id="modalHorario" class="modal-overlay">
  <div class="modal-content horario-modal">

    <span id="closeModalHorario" class="modal-close">&times;</span>

    <h2>Configurar Horario de Activación</h2>

    <label>Hora de inicio</label>
    <input type="time" id="horaInicio" class="input-horario">

    <label>Hora final</label>
    <input type="time" id="horaFin" class="input-horario">

    <p class="hint-horario">
      La cámara estará activa entre la hora de inicio y la hora final.
    </p>

    <button id="guardarHorario" class="btn-horario">Guardar horario</button>

    <p id="mensajeHorario" class="saved-badge" style="display:none;">
      ✔ Horario guardado correctamente
    </p>

  </div>
</div>


<script>
document.querySelector(".HorarioBtn").addEventListener("click", () => {
    document.getElementById("modalHorario").style.display = "flex";
});

// Cerrar modal
document.getElementById("closeModalHorario").addEventListener("click", () => {
    document.getElementById("modalHorario").style.display = "none";
});

// Guardar horario
document.getElementById("guardarHorario").addEventListener("click", () => {
    const inicio = document.getElementById("horaInicio").value;
    const fin = document.getElementById("horaFin").value;

    if (!inicio || !fin) {
        alert("Debes seleccionar ambos horarios.");
        return;
    }

    // Aquí puedes hacer un fetch a tu API si quieres
    // Ej: fetch("/save-horario", { method:"POST", body: JSON.stringify({inicio, fin}) })

    document.getElementById("mensajeHorario").style.display = "block";

    setTimeout(() => {
        document.getElementById("mensajeHorario").style.display = "none";
        document.getElementById("modalHorario").style.display = "none";
    }, 2000);
});
</script>



















</body>

</html>